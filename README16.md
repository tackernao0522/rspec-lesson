# 12. 最後のアドバイス

よくやりました! もしあなたが本書で学んだパターンやテクニックを使って自分のアプリケーションにテストを追加してきたのであれば、あなたは十分にテストされた Rails アプリケーションを作り始めたことになります。<br>
あなたがここまで頑張ってきたことを私は嬉しく思います。<br>
そして今ではテストに慣れただけでなく、本物のテスト駆動開発者のように考えることができ、さらにスペックを使ってアプリケーションの内部設計も改善できるようになっていることを期待しています。<br>
そして、あなたはきっとこのプロセスを楽しいとすら考えているはずです!<br>
本書を締めくくるために、あなたに覚えておいてほしいことをいくつか述べます。<br>
この内容を心に留めながら、引き続きこの道を進んでいってください。<br>

## 小さなテストで練習してください

複雑な新しいフィーチャを題材にして TDD を始めようとするのは、TDD のプロセスを学ぶための最善な方法とは言えないかもしれません。<br>
それよりも取り組みやすそうなアプリケーションの課題に注目してください。<br>
バグ修正や基本的なインスタンスメソッドであれば、たいてい簡単なテストで済みます。<br>
セットアップはわずかで済みますし、必要なエクスペク テーションも一つで済むことが多いです。<br>
ただし、コードを書こうとする前にスペックを忘れずに書いてください!<br>

## 自分がやっていることを意識してください

何か作業をするときは、自分が取り組んでいるプロセスを意識してください。<br>
そして、紙とペンを使いながら考えてください。<br>
今からやろうとしていることのためにスペックを書きましたか? スペックを使って境界値テストやエラー発生時のテストを書いていますか? チェックリストを作って、作業中はいつでも取り出せるようにしておいてください。<br>
そして、これからやらなければいけないことを事前に確認してください。<br>

## 短いスパイクを書くのは OK です

テスト駆動開発は必ずしもテストがないとコードが書けない、というプロセスではありません。<br>
そうではなく、スペックを書かないと本番用のコードが書けない、というプロセスです。スパイク(訳注: アーキテクチャを確立するためのプロトタイプ)を作るのは全く問題ありません!<br>
フィーチャのスコープにもよりますが、私は新しいアイデアを試すときにはよく新しい Rails アプリケーションを作ったり、Git に一時的なブランチを作ったりします。<br>
特によくあるのは、新しいライブラリを試したり、比較的大きな変更を実施する場合です。<br>
たとえば、私は一時期あるデータマイニングアプリケーションの開発をしていました。そのアプリケーションで私はユーザーインターフェイスに影響を与えることなく、モデルレイヤを完全に作り替えなければなりませんでした。<br>
私は基本的なモデルの構造がどうなるかはわかっていましたが、問題を完全に理解するためにもうちょっと良い方法を探る必要がありました。<br>
そのとき私は別のアプリケーションを用意して、この問題のスパイクを作ってみました。こうすることで、私はこれから解決しようとしている問題のために自由にハックしたり、実験したりすることができたのです。<br>
そして問題を理解し、良い解決策が見つかったところで本番用のアプリケーションに移り、実験から学んだことをベースにしてスペックを書きました。それからスペックをパスさせるコードを書きました。<br>
もっと小さな問題であれば私はフィーチャブランチを作って作業します。そして同じような実験をして、変更されたファイルはどれなのか確認します。<br>
先ほどのデータマイニングプロジェクトに話を戻すと、私は集計したデータをユーザーに見せるフィーチャを作ったこともありました。<br>
そのデータはすでにシステムに存在していたので、私は Git にブランチを作り、シンプルな解決策を試すスパイクを作ってその問題を確実に理解しました。解決策が確定したら、私は自分の書いた一時的なコードを削除し、スペックを書きました。<br>
それから先ほどの作業内容を機械的に再適用しました。<br>
私の場合、一般的なルールとして単にコメントを付けたり外したりする(もしくはコピー&ペーストする)のではなく、もう一度コードを打ち直します。<br>
なぜなら、そうした方が最初に書いたコードをリファクタリングできたり、改良できたりすることが多いからです。<br>

## 小さくコードを書き、小さくテストするのも OK です

もしあなたが最初にスペックから書き始めることをまだ難しいと感じているなら、コードを書いてからテストを書くのも良いと思います。<br>
ただし、その二つのプラクティスは必ずセットで行うというのが条件です。<br>
とはいえ、このやり方はテストを最初に書く場合に比べてより多くの自制心が要求されることを強調しておきます。<br>
言いかえるなら、私は OK とは言ったものの、それが理想的であるとは考えていません。<br>
しかし、そうした方がテストしやすいのであれば、そうしても構いません。<br>

## 統合スペックを最初に書こうとしてください

基本のプロセスが身について、さまざまなレベルでアプリケーションをテストできるようになったら、今度は全部を逆の順番にしてみましょう。<br>
つまり、モデルスペックを作り、それからコントローラスペック、システムスペック(またはリクエストスペック)、と進んでいくのではなく、まずシステムスペック(またはリクエストスペック)からスタートするのです。<br>
その際はエンドユーザーがアプリケーションを使ってタスクを完了させる手順を考えてください。これは 外から中へ(outside-in) のテストと呼ばれる一般的なアプローチです。このアプローチは第11章 でも実践しました。<br>
システムスペックをパスさせるために開発していると、他のレベルでテストした方が良い機能が見つかります。<br>
たとえば、前章ではモデルレベルでバリデーションをテストし、コントローラレベルで認証機能をテストしました。<br>
よくできたシステムスペックはそのフィーチャが関連するテストのアウトラインを導き出してくれます。<br>
なので、システムスペックから書き始められるようになるのが、身につけるべきスキルなのです。<br>

## テストをする時間を作ってください

確かに、テストは今後の保守が必要になる余分なコードです。その余分なコードをメンテナンスするのにも時間がかかります。<br>
計画を立てるときはそれを見込んでください。あなたが1〜2時間で完成できると思ったフィーチャは、もう少し時間がかかるかもしれません。<br>
この問題は特にテストを書き始めたばかりの開発者によく発生します。しかし、⻑い目で見ればその時間は取り返せるはずです。<br>
なぜなら、信頼性の高いコードベースでいつでも作業を始められるからです。<br>

## 常にシンプルにしてください

もしあなたがまだいくつかの分野のテスト(統合テストであれ、モックであれ、スタブであれ)に慣れていなくても、心配することはありません。<br>
そうした分野のテストは単に動かすだけでは終わらずに、テストのためだけにより多くのセットアップや考えが必要になります。<br>
しかし、シンプルな部分のテストをやめてはいけません。なぜならそうしたスキルも将来的にはもっと複雑なスペックを書くスキルにつながっていくからです。<br>

## 古い習慣に戻らないでください!

失敗しないはずのテストが失敗してしまい、ずっと悩んでしまうというのはよくある話です。<br>
あなたがもしパスしないテストに出くわしたら、あとで見直すためにメモを取ってください。そして、しばらくしてからそのテストを見直してください。<br>
ブラウザを使って手作業で画面をクリックするようなテストは、アプリケーションが大きくなるほど時間がかかり、どんどん退屈な作業になっていくことを思い出しましょう。<br>
そんなことをするより、スペックをもっとうまく書くために時間を使って将来の時間を節約する方がよっぽど良いですよね?<br>

## テストを使ってコードを改善してください

レッド - グリーン - リファクタ のリファクタステージを無視してはいけません。<br>
テストの声に耳を傾けるスキルを身につけてください。あなたのコードがどこかおかしい場合、テストはあなたにそれを伝えます。<br>
そして重要な機能を壊さずにコードをきれいにするお手伝いをしてくれます。<br>

## 自動テストのメリットを周りの人たちに売り込んでください

「テストを書く時間なんてあるわけがない」と今でも考えている開発者はたくさんいます。(中にはスパゲッティコードを理解している人間が世界で自分一人ならこの先も仕事は 安泰だ、とまで考える開発者がいることも私は知っています。ですが、あなたがそんなバカではないことはわかっています。)<br>
もしくはあなたの上司が理解してくれないかもしれません。上司はなぜ次のフィーチャをリリースするのにわざわざ時間をかけてテストを書くのか 理解できないかもしれません。<br>
そんな同僚を教育する時間を少し用意してください。テストは開発のためだけにあるのではないと教えてあげてください。<br>
テストはアプリケーションを⻑期にわたって安定させるためのものであり、さらに人々の心の平和を安定させるものでもあります。<br>
テストが動作する様子を彼らに見せてあげてください。私の場合、第7章で見たような JavaScript を実行するシステムスペックを披露したことがあります。<br>
このデモは彼らを驚かせ、スペックを書く時間の価値を理解してもらうのに大変役立ちました。<br>

## 練習し続けてください

最後に、言うまでもないことですが、たくさん練習しなければこのプロセスに対する技能を上達させることはできません。<br>
繰り返しになりますが、ちっぽけな Rails アプリケーションはこうした目的にうってつけです。<br>
新しいアプリ(ブログアプリと To-do リストがいつも人気です)を作り、フィーチャを実装しながら TDD を練習してください。<br>
そのフィーチャは何によって決まるのでしょうか? それはあなたが鍛えようとしているテストのスキルです。<br>
メールのスペックを上手に書けるようになりたいですか? それではブログアプリを改造して、購読者に記事の要約をメール送信してください。<br>
外部 API のテストスキルを伸ばしたいのであれば、多くのサービスが無料もしくは格安の API を開発者向けに用意してくれています。<br>
これは練習用にぴったりです。本番のプロジェクトで機能要望が上がってくるのを待っていてはいけません。自分で作るのです!<br>
